# PFR-AI: Бэкенд

Серверная часть приложения для анализа пенсионных дел, написанная на FastAPI.

## Функциональность

*   Принимает данные пенсионного дела в формате JSON.
*   Производит валидацию данных с использованием Pydantic.
*   Имитирует анализ дела на наличие ошибок по заданным правилам.
*   Возвращает список найденных ошибок или пустой список.
*   Хранит (в памяти) историю обработанных дел.
*   Предоставляет эндпоинт для получения истории.
*   Имитирует генерацию и отдачу документов (PDF/DOCX) по запросу.

## API Эндпоинты

*   **`POST /process`**: 
    *   Принимает: Тело запроса с данными дела (`CaseDataInput` из `models.py`).
    *   Возвращает: JSON с полем `errors`, содержащим список объектов ошибок (`ErrorOutput` из `models.py`) или пустой список.
*   **`GET /history`**: 
    *   Принимает: Необязательный query-параметр `limit` (по умолчанию 50).
    *   Возвращает: Список последних обработанных дел (массив объектов `HistoryEntry` из `models.py`). Каждое дело содержит `id`, `personal_data` (частично) и список `errors`.
*   **`GET /download_document/{case_id}`**: 
    *   Принимает: Path-параметр `case_id` (ID дела) и query-параметр `format` (`pdf` или `docx`).
    *   Возвращает: Файл в запрошенном формате (PDF или DOCX) с соответствующими заголовками (`Content-Disposition`). В текущей реализации имитирует отдачу простого текстового файла.

## Установка и запуск

1.  **Требования:** Python 3.9+. Желательно не выше 3.11 (3.11 - идеально)
2.  Перейдите в директорию `backend`:
    ```bash
    cd backend
    ```
3.  **Виртуальное окружение (рекомендуется):**
    ```bash
    python -m venv venv
    py -3.11 -m venv venv (Желательно установить версию 3.11)
    # Windows: .\venv\Scripts\activate
    # macOS/Linux: source ./venv/bin/activate
    ```
4.  **Установка зависимостей:**
    ```bash
    pip install -r requirements.txt 
    ```
    Основные зависимости:
    *   `fastapi`: Веб-фреймворк.
    *   `uvicorn[standard]`: ASGI сервер.
    *   `pydantic`: Валидация данных.
    *   `python-docx`: Для генерации DOCX (в текущей реализации используется для имитации).
    *   `fpdf`: Для генерации PDF (в текущей реализации используется для имитации).
5.  **Запуск сервера:**
    ```bash
    uvicorn app.api:app --reload --host 0.0.0.0 --port 8000
    ```
    *   `--reload`: Автоматическая перезагрузка при изменениях кода.
    *   Сервер будет доступен по адресу `http://127.0.0.1:8000`.
    *   Интерактивная документация API (Swagger UI) будет доступна по адресу `http://127.0.0.1:8000/docs`.

## Структура кода

*   `app/api.py`: Определяет FastAPI приложение, роутеры и эндпоинты.
*   `app/models.py`: Содержит Pydantic модели для валидации входных данных (`CaseDataInput`), выходных ошибок (`ErrorOutput`) и данных истории (`HistoryEntry`).
*   `app/logic.py`: Содержит основную "бизнес-логику": функцию `analyze_case` для имитации анализа, функцию `generate_document` для имитации создания документов и хранилище истории `case_history`.
*   `requirements.txt`: Список зависимостей Python. 