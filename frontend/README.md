# PFR-AI: Фронтенд

Клиентская часть приложения для анализа пенсионных дел, разработанная с использованием React, TypeScript и Ant Design.

**Недавние изменения:**
*   Проведена унификация модуля для взаимодействия с API: удален дублирующийся файл `src/api/client.ts`, теперь используется `src/services/client.ts`.
*   Добавлены типы (`OcrExtractionResponse` и др. в `src/types.ts`) и функция (`extractDocumentData` в `src/services/client.ts`) для будущей интеграции OCR-модуля.
*   Произведен переход с Chakra UI на Ant Design. Удалены все зависимости Chakra UI. Файл `theme.ts` был удален.

## Функциональность

*   **Аутентификация**: Реализована система входа пользователей с использованием JWT токенов. Доступ к большинству разделов приложения защищен.
*   Отображает многошаговую форму для ввода данных пенсионного дела.
*   Использует `react-hook-form` для управления состоянием формы и валидации (интеграция с Ant Design `Form` для отображения ошибок).
*   Использует `react-datepicker` и `react-imask` (через `CustomDateInput`) для удобного ввода дат и СНИЛС с масками.
*   **Использует кастомный компонент `TagInput` (адаптированный под Ant Design) для удобного ввода списков льгот и документов.**
*   Отправляет данные формы на бэкенд (`/process`) для базового анализа и сохранения **через функции в `src/services/apiClient.ts`**.
*   Предоставляет кнопку "RAG Анализ", которая отправляет описание дела на эндпоинт `/api/v1/analyze_case` **через функции в `src/services/apiClient.ts`**.
*   Отображает текстовый результат RAG-анализа в отдельном блоке под формой.
*   Отображает результаты базового анализа (`ProcessResult`) с помощью компонента `ProcessResultDisplay` и уведомлений `antd Message`. **Текст объяснения в `ProcessResultDisplay` теперь поддерживает Markdown-форматирование.**
*   Реализует отдельную страницу для просмотра истории обработанных дел (`/history`).
*   Загружает и отображает историю дел с помощью компонента `HistoryList` (используя Ant Design `Table`), **используя API-клиент из `src/services/apiClient.ts`**.
*   Позволяет скачивать документы (PDF/DOCX) для записей истории, **обращаясь к API через `src/services/apiClient.ts`**.
*   Использует `react-router-dom` для навигации между страницами.
*   Использует стандартные возможности темизации Ant Design. Компонент `App.tsx` оборачивает приложение в `ConfigProvider` от Ant Design для локализации и потенциальной настройки темы.
*   **Меню навигации расположено в верхней части страницы (Header).** Отображает информацию о пользователе и кнопку выхода при аутентификации, или кнопку входа в противном случае.
*   **(В разработке)** Функциональность OCR для предзаполнения данных из документов через эндпоинт `/extract_document_data`. Шаг OCR теперь является вторым шагом в форме, после выбора типа пенсии.

## Основные компоненты

*   **`App.tsx`**: Корневой компонент, оборачивает приложение в `AuthProvider`, настраивает маршрутизацию (Ant Design `Layout`, `Menu` в `Header`, `Breadcrumb`). Защищает маршруты с помощью `ProtectedRoute`.
*   **`pages/LoginPage.tsx`**: Страница для входа пользователя в систему.
*   **`pages/HistoryPage.tsx`**: Страница отображения истории. Загружает данные с `/history` **через API-клиент**, отображает `HistoryList` (Ant Design `Table`).
*   **`pages/HomePage.tsx`**: Содержит логику многошаговой формы (Ant Design `Steps`, `Form`). **Вызывает функции API-клиента для отправки данных**, рендерит компоненты шагов.
*   **`components/formSteps/*`**: Компоненты для шагов формы (используют компоненты Ant Design).
*   **`components/formInputs/*`**: Переиспользуемые компоненты для полей формы (`CustomDateInput`, `TagInput` - адаптированные/использующие Ant Design).
*   **`components/HistoryList.tsx`**: Компонент для отображения списка истории дел (удален, логика перенесена в `CaseHistoryPage` с использованием Ant Design `Table`).
*   **`components/ProcessResultDisplay.tsx`**: Компонент для отображения результатов базового анализа (использует Ant Design `Alert`, `Result`). **Теперь поддерживает Markdown в текстовом объяснении.**
*   **`components/ProtectedRoute.tsx`**: Компонент-обертка для защиты маршрутов, требующих аутентификации.
*   **`contexts/AuthContext.tsx`**: Контекст React для управления состоянием аутентификации пользователя (токен, данные пользователя, статус загрузки, ошибки аутентификации) и предоставления функций `login` и `logout`.
*   **`services/apiClient.ts`**: **Модуль с функциями для взаимодействия с API бэкенда.** (переименован из `client.ts`). Включает функции для аутентификации и автоматически добавляет JWT токен в заголовки защищенных запросов.
*   **`utils.ts`**: Содержит вспомогательные функции.

## Установка и запуск

1.  **Требования:** Node.js (рекомендуется LTS версия), npm.
2.  Перейдите в директорию `frontend`:
    ```bash
    cd frontend
    ```
3.  **Установка зависимостей:**
    ```bash
    npm install
    ```
    Основные зависимости:
    *   `react`, `react-dom`: Библиотека UI.
    *   `typescript`: Типизация JavaScript.
    *   `antd`, `@ant-design/icons`: Библиотека UI компонентов Ant Design.
    *   `react-hook-form`: Управление формами.
    *   `react-router-dom`: Маршрутизация.
    *   `react-datepicker`: Компонент выбора даты.
    *   `react-imask`: Компонент для масок ввода.
    *   `date-fns`: Библиотека для работы с датами.
    *   `dayjs`: Используется Ant Design для работы с датами.
    *   `react-icons`: Библиотека иконок.
    *   `react-toastify`: Уведомления (может быть заменено на `antd Message/Notification`).
    *   `remark-gfm`, `remark-math`, `rehype-katex`, `katex`: Для расширенной обработки Markdown и LaTeX на странице деталей дела.
    *   Используется `fetch` в `src/services/apiClient.ts` для HTTP-запросов.
4.  **Запуск сервера для разработки:**
    ```bash
    npm run dev
    ```
    Приложение будет доступно по адресу `http://localhost:5173` (или другому порту, указанному Vite). Сервер поддерживает Hot Module Replacement (HMR).
5.  **Сборка для продакшена:**
    ```bash
    npm run build
    ```
    Готовые к развертыванию файлы будут помещены в директорию `dist`.
6.  **Линтинг:**
    ```bash
    npm run lint
    ```

## Зависимость от Бэкенда

Фронтенд ожидает, что бэкенд запущен и доступен. Адрес бэкенда (`API_BASE_URL`) настраивается через переменные окружения Vite (например, в файле `.env.local` можно указать `VITE_API_BASE_URL=http://127.0.0.1:8000/api/v1`). По умолчанию используется `http://localhost:8000/api/v1`. Все API запросы направляются на этот адрес **через функции в `src/services/apiClient.ts`**.

**Для работы аутентификации убедитесь, что ваш бэкенд поддерживает эндпоинты `/auth/token` и `/users/me` согласно предоставленной API документации.**
